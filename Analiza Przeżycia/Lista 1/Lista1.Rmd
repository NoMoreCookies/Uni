---
title: "Lista1 Analiza Przeżycia"
output: html_document
date: "2025-10-25"
---

```{r libraries_import}
library(ggplot2)
library(dplyr)
library(tidyr)
```

Zadanie 1

Gęstość funkcji $$
f(t,\alpha,\beta,\gamma)=
\frac{\alpha\gamma}{\beta}
\left(\frac{t}{\beta}\right)^{\alpha-1}
\left[1-\exp\!\left(-\left(\frac{t}{\beta}\right)^{\alpha}\right)\right]^{\gamma-1}
\exp\!\left(-\left(\frac{t}{\beta}\right)^{\alpha}\right)\,
\mathbf{1}_{(0,\infty)}(t).
$$

```{r gęstość_f}

# Gęstość f(t; alpha, beta, gamma)
dexpwei <- function(t, alpha, beta, gamma) {
  if (any(c(alpha, beta, gamma) <= 0)) stop("alpha, beta, gamma muszą być > 0.")
  t <- pmax(t, 0)  # dla t<0 gęstość = 0 (zostawimy to jawnie niżej)
  f <- (alpha * gamma / beta) *
    ( (t / beta)^(alpha - 1) ) *
    exp( - (t / beta)^alpha ) *
    ( 1 - exp( - (t / beta)^alpha ) )^(gamma - 1)
  f[ t < 0 ] <- 0
  f
}

```

Dystrybuanta funkcji

$$
F(t,\alpha,\beta,\gamma)=
\begin{cases}
\left[1-\exp\!\left(-\left(\dfrac{t}{\beta}\right)^{\alpha}\right)\right]^{\gamma}, & t\ge 0,\\[6pt]
0, & t<0~.
\end{cases}
$$

```{r dyst_funkcji}

# (opcjonalnie) Dystrybuanta — przydaje się do wyznaczenia zakresu osi
pexpwei <- function(t, alpha, beta, gamma) {
  if (any(c(alpha, beta, gamma) <= 0)) stop("alpha, beta, gamma muszą być > 0.")
  out <- ( 1 - exp( - (pmax(t,0) / beta)^alpha ) )^gamma
  out[ t < 0 ] <- 0
  out
}

```

Odwrotna dystrybuanta

$$
Q(p;\alpha,\beta,\gamma)
= \beta \left[-\ln\!\big(1 - p^{1/\gamma}\big)\right]^{1/\alpha},
\qquad 0 < p < 1.
$$

```{r odw_dyst}

qexpwei <- function(p, alpha, beta, gamma) {
  if (any(p < 0 | p > 1)) stop("p must be in [0,1]")
  if (any(c(alpha, beta, gamma) <= 0)) stop("alpha, beta, gamma must be > 0")

  q <- beta * (-log(1 - p^(1/gamma)))^(1/alpha)
  q[p == 0] <- 0
  q[p == 1] <- Inf
  q
}

```

Funkcja hazardu

$$
h(t,\alpha,\beta,\gamma)
= \frac{f(t,\alpha,\beta,\gamma)}{1 - F(t,\alpha,\beta,\gamma)}
= \frac{f(t,\alpha,\beta,\gamma)}{S(t)} ,
$$

```{r f_hazardu}

# Hazard: h(t) = f(t) / (1 - F(t)), dla t >= 0
hexpwei <- function(t, alpha, beta, gamma) {
  if (any(c(alpha, beta, gamma) <= 0)) stop("alpha, beta, gamma muszą być > 0.")
  f <- dexpwei(t, alpha, beta, gamma)
  S <- 1 - pexpwei(t, alpha, beta, gamma)
  # ochrona numeryczna przed dzieleniem przez 0
  h <- f / pmax(S, .Machine$double.eps)
  h[t < 0] <- 0
  h
}

```

Funkcja kwantylowa

$$
Q(p;\alpha,\beta,\gamma)
= \beta\left[-\ln\!\Big(1-p^{1/\gamma}\Big)\right]^{1/\alpha},
\qquad 0<p<1,
$$

```{r f_kwantylowa}

# (opcjonalnie) Kwantyl — użyjemy do automatycznego doboru prawego krańca wykresu
qexpwei <- function(p, alpha, beta, gamma) {
  if (any(c(alpha, beta, gamma) <= 0)) stop("alpha, beta, gamma muszą być > 0.")
  if (any(p < 0 | p > 1)) stop("p musi być w [0,1].")
  ifelse(p == 0, 0,
         ifelse(p == 1, Inf,
                beta * (-log(1 - p^(1/gamma)))^(1/alpha)))
}

```


Zadanie 2


```{r zadanie2}

x_values = seq(0.1,10,0.01)

args_list <- list(
  c(0.5, 2, 3/4),
  c(1, 2, 1),
  c(3/2, 3, 3),
  c(3/2, 4, 1/8),
  c(3/4, 1, 2)
)
df = data.frame(x_values)
for( args in args_list ){
  
  y_values = dexpwei(x_values,args[1],args[2],args[3])/(1-pexpwei(x_values,args[1],args[2],args[3]))
  df = cbind(df,y_values)
}

colnames(df) = c("x","y1","y2","y3","y4","y5")


df_long <- df %>%
  pivot_longer(cols = starts_with("y"),
               names_to = "Argumenty",
               values_to = "hazard")

labels <- c(
  expression(gamma == 0.5 ~ "," ~ beta == 2 ~ "," ~ alpha == 3/4),
  expression(gamma == 1 ~ "," ~ beta == 2 ~ "," ~ alpha == 1),
  expression(gamma == 3/2 ~ "," ~ beta == 3 ~ "," ~ alpha == 3),
  expression(gamma == 3/2 ~ "," ~ beta == 4 ~ "," ~ alpha == 1/8),
  expression(gamma == 3/4 ~ "," ~ beta == 1 ~ "," ~ alpha == 2)
)

ggplot(df_long, aes(x = x, y = hazard, color = Argumenty)) +
  geom_line() +
  scale_color_manual(values = c("red", "blue", "green", "purple", "orange"),
                     labels = labels) +
  theme_minimal()
```

Zadanie 3

```{r generator}

generate_n_numbers <-function(n,alpha,beta,gamma){
  return (qexpwei(runif(n),alpha,beta,gamma))
}

numbers <- generate_n_numbers(1000,1,1,1) 

```

zadanie 4

```{r zad 4}
n <- c(50, 100)

args_list <- list(
  c(0.5, 2, 3/4),
  c(3/2, 3, 3)
)

generate_n_numbers <- function(n, a, b, c) rexp(n, rate = 1/a)
dexpwei <- function(x, a, b, c) dweibull(x, shape = b, scale = a)

plot_hist_with_pdf <- function(x, a, b, c, my_pdf, n, add_ylabel = FALSE) {
  hist(
    x, breaks = "FD", freq = FALSE, col = "grey90", border = "white",
    main = bquote(n == .(n)), xlab = "x", ylab = if (add_ylabel) "Density" else "",
    cex.main = 1.2, cex.lab = 1.1
  )
  rng <- range(x)
  curve(my_pdf(x, a, b, c), from = rng[1], to = rng[2], add = TRUE, lwd = 2, col = "blue")
}

graph_generator_grid <- function(n_vec, args_list) {
  par(mfrow = c(length(n_vec), length(args_list)),
      oma = c(3, 4, 4, 1), # outer margins (bottom, left, top, right)
      mar = c(4, 2, 3, 1)) # inner margins for each plot
  
  for (i in seq_along(n_vec)) {
    for (j in seq_along(args_list)) {
      a <- args_list[[j]][1]
      b <- args_list[[j]][2]
      c <- args_list[[j]][3]
      x <- generate_n_numbers(n_vec[i], a, b, c)
      
      add_ylabel <- (j == 1) # only first column gets "Density" label
      plot_hist_with_pdf(x, a, b, c, dexpwei, n_vec[i], add_ylabel)
      
      # Top labels only for the first row
      if (i == 1) {
        mtext(bquote(gamma == .(a) ~ "," ~ beta == .(b) ~ "," ~ alpha == .(c)),
              side = 3, line = 1.5, cex = 1.1)
      }
    }
  }
  # Add shared axis titles
  mtext("x", side = 1, outer = TRUE, line = 1.5)
  mtext("Density", side = 2, outer = TRUE, line = 2.5)
}

graph_generator_grid(n, args_list)

```

zadanie 5

```{r zadanie 5}
#tutaj tabelę trzeba dodać

for (col in lst) {
  x <- col
  if (is.numeric(x)) {
    print(c(summary(x), sd = sd(x, na.rm = TRUE)))
  } else {
    print(summary(x))
  }
}

#te kwantyle zajebane

print(qexpwei(1/4,args_list[[1]][1],args_list[[1]][2],args_list[[1]][3]))
print(qexpwei(1/4,args_list[[2]][1],args_list[[2]][2],args_list[[2]][3]))

print(qexpwei(1/2,args_list[[1]][1],args_list[[1]][2],args_list[[1]][3]))
print(qexpwei(1/2,args_list[[2]][1],args_list[[2]][2],args_list[[2]][3]))

print(qexpwei(3/4,args_list[[1]][1],args_list[[1]][2],args_list[[1]][3]))
print(qexpwei(3/4,args_list[[2]][1],args_list[[2]][2],args_list[[2]][3]))

```
