---
title: "Lista1 Analiza Przeżycia"
output: html_document
date: "2025-10-25"
---

```{r libraries}
library(ggplot2)
library(dplyr)
library(tidyr)


```

Zadanie 1

Gęstość funkcji
\[
f(t,\alpha,\beta,\gamma)=
\frac{\alpha\gamma}{\beta}
\left(\frac{t}{\beta}\right)^{\alpha-1}
\left[1-\exp\!\left(-\left(\frac{t}{\beta}\right)^{\alpha}\right)\right]^{\gamma-1}
\exp\!\left(-\left(\frac{t}{\beta}\right)^{\alpha}\right)\,
\mathbf{1}_{(0,\infty)}(t).
\]

```{r gęstość_f}

# Gęstość f(t; alpha, beta, gamma)
dexpwei <- function(t, alpha, beta, gamma) {
  if (any(c(alpha, beta, gamma) <= 0)) stop("alpha, beta, gamma muszą być > 0.")
  t <- pmax(t, 0)  # dla t<0 gęstość = 0 (zostawimy to jawnie niżej)
  f <- (alpha * gamma / beta) *
    ( (t / beta)^(alpha - 1) ) *
    exp( - (t / beta)^alpha ) *
    ( 1 - exp( - (t / beta)^alpha ) )^(gamma - 1)
  f[ t < 0 ] <- 0
  f
}

```

Dystrybuanta funkcji

\[
F(t,\alpha,\beta,\gamma)=
\begin{cases}
\left[1-\exp\!\left(-\left(\dfrac{t}{\beta}\right)^{\alpha}\right)\right]^{\gamma}, & t\ge 0,\\[6pt]
0, & t<0~.
\end{cases}
\]

```{r dyst_funkcji}

# (opcjonalnie) Dystrybuanta — przydaje się do wyznaczenia zakresu osi
pexpwei <- function(t, alpha, beta, gamma) {
  if (any(c(alpha, beta, gamma) <= 0)) stop("alpha, beta, gamma muszą być > 0.")
  out <- ( 1 - exp( - (pmax(t,0) / beta)^alpha ) )^gamma
  out[ t < 0 ] <- 0
  out
}

```

Odwrotna dystrybuanta

\[
Q(p;\alpha,\beta,\gamma)
= \beta \left[-\ln\!\big(1 - p^{1/\gamma}\big)\right]^{1/\alpha},
\qquad 0 < p < 1.
\]

```{r odw_dyst}

qexpwei <- function(p, alpha, beta, gamma) {
  if (any(p < 0 | p > 1)) stop("p must be in [0,1]")
  if (any(c(alpha, beta, gamma) <= 0)) stop("alpha, beta, gamma must be > 0")

  q <- beta * (-log(1 - p^(1/gamma)))^(1/alpha)
  q[p == 0] <- 0
  q[p == 1] <- Inf
  q
}

```

Funkcja hazardu

\[
h(t,\alpha,\beta,\gamma)
= \frac{f(t,\alpha,\beta,\gamma)}{1 - F(t,\alpha,\beta,\gamma)}
= \frac{f(t,\alpha,\beta,\gamma)}{S(t)} ,
\]

```{r f_hazardu}

# Hazard: h(t) = f(t) / (1 - F(t)), dla t >= 0
hexpwei <- function(t, alpha, beta, gamma) {
  if (any(c(alpha, beta, gamma) <= 0)) stop("alpha, beta, gamma muszą być > 0.")
  f <- dexpwei(t, alpha, beta, gamma)
  S <- 1 - pexpwei(t, alpha, beta, gamma)
  # ochrona numeryczna przed dzieleniem przez 0
  h <- f / pmax(S, .Machine$double.eps)
  h[t < 0] <- 0
  h
}

```
Funkcja kwantylowa

\[
Q(p;\alpha,\beta,\gamma)
= \beta\left[-\ln\!\Big(1-p^{1/\gamma}\Big)\right]^{1/\alpha},
\qquad 0<p<1,
\]

```{r f_kwantylowa}

# (opcjonalnie) Kwantyl — użyjemy do automatycznego doboru prawego krańca wykresu
qexpwei <- function(p, alpha, beta, gamma) {
  if (any(c(alpha, beta, gamma) <= 0)) stop("alpha, beta, gamma muszą być > 0.")
  if (any(p < 0 | p > 1)) stop("p musi być w [0,1].")
  ifelse(p == 0, 0,
         ifelse(p == 1, Inf,
                beta * (-log(1 - p^(1/gamma)))^(1/alpha)))
}

```

Zadanie 2

```{r zadanie2}

x_values = seq(0.1,10,0.01)

args_list <- list(
  c(0.5, 2, 3/4),
  c(1, 2, 1),
  c(3/2, 3, 3),
  c(3/2, 4, 1/8),
  c(3/4, 1, 2)
)
df = data.frame(x_values)
for( args in args_list ){
  
  y_values = dexpwei(x_values,args[1],args[2],args[3])/(1-pexpwei(x_values,args[1],args[2],args[3]))
  df = cbind(df,y_values)
}
colnames(df) = c("x","y1","y2","y3","y4","y5")

# ---- reshape data into long format ----
df_long <- df %>%
  pivot_longer(cols = starts_with("y"),
               names_to = "curve",
               values_to = "hazard")

# ---- plot all curves in one ggplot ----
ggplot(df_long, aes(x = x, y = hazard, color = curve)) +
  geom_line(size = 1) +
  labs(
    title = "Hazard functions for different parameter sets",
    x = "t",
    y = "h(t)",
    color = "Curve"
  ) +
  theme_minimal(base_size = 14)
```

Zadanie 3 

```{r generator}

generate_n_numbers <-function(n,alpha,beta,gamma){
  return (qexpwei(runif(n),alpha,beta,gamma))
}

numbers <- generate_n_numbers(1000,1,1,1) 
print(numbers)
```

zadanie 4

```{r zad 4}

n = c(50,100)

args_list <- list(
  c(0.5, 2, 3/4),
  c(3/2, 3, 3)
)

plot_hist_with_pdf <- function(x, a, b, c,my_pdf) {
  hist(x, breaks = "FD", freq = FALSE, col = "grey90",
       border = "white", main = sprintf("n=%d | (%.3g, %.3g, %.3g)", n, a, b, c),
       xlab = "x")
  rng <- range(x)
  curve(my_pdf(x, a, b, c), from = rng[1], to = rng[2], add = TRUE, lwd = 2)
}

graph_generator <- function(n,args_list){
  
  lst <- list()
  
  for (i in n ){
    
    df = data.frame(matrix(nrow = i, ncol = 0))
    
    for (j in args_list){
    df[[paste0("series_",i,"_",j[1])]] = generate_n_numbers(i,j[1],j[2],j[3])
      
    print(plot_hist_with_pdf(df[[paste0("series_",i,"_",j[1])]],j[1],j[2],j[3],dexpwei))
    
    }
    lst <- append(lst,df)

  }
  return(lst)
}
lst = graph_generator(n,args_list )
```



zadanie 5 


```{r zadanie 5}


for (col in lst) {
  x <- col
  if (is.numeric(x)) {
    print(c(summary(x), sd = sd(x, na.rm = TRUE)))
  } else {
    print(summary(x))
  }
}

#te kwantyle zajebane

print(qexpwei(1/4,args_list[[1]][1],args_list[[1]][2],args_list[[1]][3]))
print(qexpwei(1/4,args_list[[2]][1],args_list[[2]][2],args_list[[2]][3]))

print(qexpwei(1/2,args_list[[1]][1],args_list[[1]][2],args_list[[1]][3]))
print(qexpwei(1/2,args_list[[2]][1],args_list[[2]][2],args_list[[2]][3]))

print(qexpwei(3/4,args_list[[1]][1],args_list[[1]][2],args_list[[1]][3]))
print(qexpwei(3/4,args_list[[2]][1],args_list[[2]][2],args_list[[2]][3]))

```